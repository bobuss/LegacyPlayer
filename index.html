<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>node-player</title>

    <style>

        * {
            font-family: Arial, Helvetica, sans-serif;
        }

        label {
            color: black;
            display: block;
            width: 15em;
            float: left;
        }

        label:after {
            content: ": "
        }

        input {
            padding: 3px;
            box-shadow: 3px 3px 5px grey;
            font-size: 14px;
            font-weight: 600;
            width: 30em;
        }

        button {
            padding: 10px;
            border: 1px solid gray;
            border-radius: 5px;
            margin-left: auto;
            margin-right: auto;
            width: 100px;

        }

        button:focus {
            outline: 2px solid gray;
            font-weight: bold;
            color: white;
        }

        button:hover {
            background-color: orange;
            box-shadow: 3px 3px 5px grey;
            cursor: pointer;
        }




    </style>

</head>

<body>

    <main>

        <div class="scopes">
            <canvas id="visualizer1"></canvas>
            <canvas id="visualizer2"></canvas>
            <canvas id="visualizer3"></canvas>
        </div>

        <div class="loaders">
            <button id="loadmpt">LOAD MPT</button>
            <button id="loadsc68">LOAD SC68</button>
            <button id="loadahx">LOAD AHX</button>
            <button id="loadpt">LOAD PT</button>
            <button id="loadft2">LOAD FT2</button>
            <button id="loadst3">LOAD ST3</button>
        </div>


        <div class="controls">
            <button id="play">PLAY</button>
            <button id="stop">STOP</button>
        </div>


        <div class="range">
            <label for="stereoSeparation">Stereo Separation</label>
            <input value="100" type="range" orient="horizontal" min="0" max="200" step="1" id="stereoSeparation" />
        </div>


        <div class="range">
            <label for="panning">Panning</label>
            <input value="0" type="range" orient="horizontal" min="-1" max="1" step="0.1" id="panning" />
        </div>
    </main>

</body>

<script type="module">

    import { NodePlayer } from './node_player.js';
    import { Spectrum } from './visu_spectrum.js'
    import { VuMeter } from './visu_vumeter.js'
    import { Scope } from './visu_scope.js'

    const songUrlMPT = 'http://modland.com/pub/modules/Fasttracker%202/Jugi/onward.xm'
    const songUrlSC68 = 'http://modland.com/pub/modules/SC68/Jochen%20Hippel/wings%20of%20death%20-%20title.sc68'
    const songUrlAHX = 'http://modland.com/pub/modules/AHX/AceMan/arrrr!ghwblwubwubwub.ahx'
    const songUrlPT = 'http://modland.com/pub/modules/Protracker/Travolta/spacefunk.mod'

    const songUrlFT2 = 'http://modland.com/pub/modules/Fasttracker%202/Jugi/dope.xm'

    const songUrlST3 = 'http://modland.com/pub/modules/Screamtracker%203/Skaven/2nd%20reality.s3m'

    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    const player = new NodePlayer(audioContext)

    const canvas1 = document.getElementById('visualizer1')
    const scope1 = new Spectrum(canvas1)
    player.connect(player.leftNode, scope1)

    const canvas2 = document.getElementById('visualizer2')
    const scope2 = new VuMeter(canvas2)
    player.connect(player.rightNode, scope2)

    const canvas3 = document.getElementById('visualizer3')
    const scope3 = new Scope(canvas3)
    player.connect(player.masterNode, scope3)

    player.enableSpectrum();


    await player.loadWorkletProcessor('sc68')
    await player.loadWorkletProcessor('openmpt')
    await player.loadWorkletProcessor('ahx')
    await player.loadWorkletProcessor('pt')
    await player.loadWorkletProcessor('ft2')
    await player.loadWorkletProcessor('st3')

    const loadmptButton = document.getElementById('loadmpt');
    loadmptButton.addEventListener('click', async (e) => {
        await player.load(songUrlMPT);
    });

    const loadsc68Button = document.getElementById('loadsc68');
    loadsc68Button.addEventListener('click', async (e) => {
        await player.load(songUrlSC68);
    });

    const loadAHXButton = document.getElementById('loadahx');
    loadAHXButton.addEventListener('click', async (e) => {
        await player.load(songUrlAHX);
    });

    const loadPTButton = document.getElementById('loadpt');
    loadPTButton.addEventListener('click', async (e) => {
        await player.load(songUrlPT)
    });

    const loadFT2Button = document.getElementById('loadft2');
    loadFT2Button.addEventListener('click', async (e) => {
        await player.load(songUrlFT2)
    });

    const loadST3Button = document.getElementById('loadst3');
    loadST3Button.addEventListener('click', async (e) => {
        await player.load(songUrlST3)
    });

    const playButton = document.getElementById('play');
    playButton.addEventListener('click', async (e) => {
        player.play()
    });

    const stopButton = document.getElementById('stop');
    stopButton.addEventListener('click', async (e) => {
        player.pause()
    });

    const stereoSeparationInput = document.getElementById('stereoSeparation');
    stereoSeparationInput.addEventListener('input', async(e) => {
        e.preventDefault();
        player.setStereoSeparation(e.target.value)
    });

    const panningInput = document.getElementById('panning');
    panningInput.addEventListener('input', async(e) => {
        e.preventDefault();
        player.setPanning(e.target.value)
    });


</script>

</html>
